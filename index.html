<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acesso Exclusivo</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .gradient-bg {
            background-color: #111827;
            background-image: radial-gradient(at 47% 33%, hsl(203.00, 39%, 25%) 0, transparent 59%), 
                              radial-gradient(at 82% 65%, hsl(289.00, 39%, 25%) 0, transparent 55%);
        }
        .glow-on-hover {
            box-shadow: 0 0 8px #e879f9, 0 0 16px #e879f9;
        }
        .map-preview-container {
            position: relative;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        .map-preview-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .map-preview-container .overlay {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        .calendar-day.available {
            background-color: rgba(236, 72, 153, 0.3);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .calendar-day.available:hover, .calendar-day.selected {
            background-color: rgba(236, 72, 153, 0.7);
            color: white;
        }
        .time-slot.available {
            background-color: rgba(236, 72, 153, 0.3);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .time-slot.available:hover, .time-slot.selected {
            background-color: rgba(236, 72, 153, 0.7);
            color: white;
        }
    </style>
</head>
<body class="gradient-bg text-gray-200">

    <div id="loading-spinner" class="min-h-screen flex flex-col items-center justify-center text-center">
        <svg class="animate-spin h-10 w-10 text-pink-400 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <p class="mt-4 text-lg font-medium">A personalizar a sua experiência...</p>
    </div>

    <main id="main-content" class="hidden w-full max-w-lg mx-auto bg-gray-900/50">
        
        <div id="pre-payment-view">
            <div class="bg-green-800/50 text-green-300 text-xs text-center p-2 flex items-center justify-center">
                <i data-lucide="shield-check" class="w-4 h-4 mr-2"></i>A sua navegação é 100% anónima e segura.
            </div>
            <img id="model-main-image" src="" alt="Foto da modelo" class="w-full h-auto object-cover aspect-[3/4]">
            <div class="p-4">
                <div class="flex items-center justify-between">
                    <h1 id="model-name" class="text-3xl font-bold text-white"></h1>
                    <span class="bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full flex items-center shrink-0"><i data-lucide="check-circle" class="w-4 h-4 mr-1"></i> Verificado</span>
                </div>
                <p id="model-location" class="text-lg text-pink-400 font-semibold"></p>
                <div class="flex items-center text-yellow-400 mt-1">
                    <i data-lucide="star" class="w-5 h-5 fill-current"></i><i data-lucide="star" class="w-5 h-5 fill-current"></i><i data-lucide="star" class="w-5 h-5 fill-current"></i><i data-lucide="star" class="w-5 h-5 fill-current"></i><i data-lucide="star" class="w-5 h-5 fill-current"></i>
                    <span id="model-reviews" class="text-gray-300 ml-2 text-sm"></span>
                </div>
                <div class="grid grid-cols-3 gap-2 text-center my-4 bg-gray-800/50 p-3 rounded-xl">
                    <div><i data-lucide="image" class="w-8 h-8 mx-auto text-pink-400"></i><p class="font-bold text-white text-lg">+100</p><p class="text-xs text-gray-400">Fotos</p></div>
                    <div><i data-lucide="video" class="w-8 h-8 mx-auto text-pink-400"></i><p class="font-bold text-white text-lg">+50</p><p class="text-xs text-gray-400">Vídeos</p></div>
                    <div><i data-lucide="map-pin" class="w-8 h-8 mx-auto text-pink-400"></i><p class="font-bold text-white text-lg">Endereço</p><p class="text-xs text-gray-400">Verificado</p></div>
                </div>
                <p id="model-bio" class="text-gray-300 leading-relaxed"></p>
                <div class="mt-6">
                    <h3 class="font-semibold text-white text-center text-xl mb-3">Localização Exata Bloqueada</h3>
                    <div class="map-preview-container h-32">
                        <img id="blurred-map-img" src="https://placehold.co/400x200/1f2937/4b5563?text=A+carregar+mapa..." alt="Mapa desfocado">
                        <div class="overlay bg-black/60 backdrop-blur-md">
                            <i data-lucide="map-pin" class="w-8 h-8 text-red-500"></i>
                            <p id="map-location-text" class="font-bold text-white text-lg"></p>
                            <p class="text-xs text-gray-400 font-mono">Pague para revelar o endereço</p>
                        </div>
                    </div>
                </div>
                <div class="mt-6">
                    <h3 class="font-semibold text-white text-center text-xl mb-3">Agende um Programa</h3>
                    <div class="bg-gray-800/50 p-4 rounded-xl">
                        <div class="text-center font-bold text-white mb-2">Setembro 2025</div>
                        <div class="grid grid-cols-7 text-center text-xs text-gray-400 mb-2"><span>D</span><span>S</span><span>T</span><span>Q</span><span>Q</span><span>S</span><span>S</span></div>
                        <div id="calendar-grid" class="grid grid-cols-7 text-center text-sm gap-1"></div>
                        <div id="time-slots-container" class="mt-4 text-center"></div>
                        <div id="booking-cta-container" class="mt-4 text-center hidden">
                            <button disabled class="w-full bg-gray-600 text-gray-400 font-bold py-3 rounded-lg">Confirmar Agendamento</button>
                            <p class="text-xs text-pink-400 mt-2">Pague o acesso para poder agendar</p>
                        </div>
                    </div>
                </div>
                <div class="mt-6">
                    <h3 class="font-semibold text-white text-center text-xl mb-3">Bónus: Outros Perfis na sua Região</h3>
                    <div id="other-models-preview" class="space-y-2"></div>
                </div>
                <div class="mt-6 bg-gray-800 p-4 rounded-xl sticky bottom-4">
                    <div class="flex justify-between items-center text-lg">
                        <span class="font-medium text-gray-300">Pagamento Único</span>
                        <span id="model-price" class="font-bold text-2xl text-pink-400"></span>
                    </div>
                    <a id="stripe-link" href="https://buy.stripe.com/4gw16Xa1K6rm12wfZ9" target="_blank" class="block w-full text-center bg-pink-600 text-white font-bold py-4 px-6 rounded-lg mt-4 text-lg hover:bg-pink-700 transition-all duration-300 transform hover:scale-105 glow-on-hover">
                        Desbloquear Tudo por € 13
                    </a>
                    <button id="simulate-payment-btn" class="w-full text-center text-gray-400 text-xs mt-2 hover:text-white">(Simular Confirmação de Pagamento)</button>
                </div>
            </div>
        </div>
        
        <div id="post-payment-view" class="hidden p-4">
             <div class="text-center my-6"><i data-lucide="party-popper" class="w-16 h-16 text-green-400 mx-auto"></i><h2 class="text-3xl font-bold text-white mt-4">Acesso Liberado!</h2><p class="text-gray-300 text-lg mt-2">Todo o conteúdo foi desbloqueado.</p></div>
            <div class="bg-gray-800 p-4 rounded-xl mb-6"><h3 class="text-xl font-semibold text-pink-400 flex items-center mb-3"><i data-lucide="calendar-check" class="w-6 h-6 mr-2"></i>Agenda Disponível</h3><p class="text-center text-white">Agora pode confirmar o seu agendamento!</p></div>
            <div class="bg-gray-800 p-4 rounded-xl mb-6"><h3 class="text-xl font-semibold text-pink-400 flex items-center mb-3"><i data-lucide="map-pin" class="w-6 h-6 mr-2"></i>Endereço de <span id="unlocked-model-name" class="ml-1"></span></h3><div class="map-preview-container h-32 mb-3"><img id="unlocked-map-img" src="" alt="Mapa nítido"><div class="overlay bg-transparent"><i data-lucide="map-pin" class="w-8 h-8 text-red-500 drop-shadow-lg"></i></div></div><p id="unlocked-address" class="text-md text-white font-mono bg-gray-900 p-3 rounded"></p></div>
            <div class="mb-6"><h3 class="text-xl font-semibold text-pink-400 mb-3 flex items-center"><i data-lucide="camera" class="w-6 h-6 mr-2"></i>+100 Fotos e +50 Vídeos</h3><div id="unlocked-gallery" class="grid grid-cols-3 gap-2"></div></div>
            <div><h3 class="text-xl font-bold text-white mb-3 text-center"><i data-lucide="users" class="w-6 h-6 mx-auto mb-1 text-yellow-400"></i>Bónus: Outros Perfis Desbloqueados</h3><div id="other-models-list" class="space-y-2"></div></div>
        </div>
    </main>

    <script>
        const API_BASE_URL = 'https://novaapi-one.vercel.app/api';
        const SELLER_API_KEY = 'SUA_CHAVE_API_DE_VENDEDOR_AQUI';
        const CHECKOUT_ID = 1;

        const mockDatabase = {
            mainModel: {
                name: 'Juliana, 24', bio: 'Universitária, apaixonada por conversas inteligentes e momentos inesquecíveis...', price: '€ 13,00', reviews: '28 Avaliações', mainImage: 'https://placehold.co/600x800/2D3748/E9D8FD?text=Juliana', address: 'Rua das Flores Secretas, 123 - Centro\n(Apto 45 - Interfone: 1234)', gallery: ['https://placehold.co/400x400/C53030/FFFFFF?text=Foto+1','https://placehold.co/400x400/2C5282/FFFFFF?text=Foto+2','https://placehold.co/400x400/2F855A/FFFFFF?text=Foto+3','https://placehold.co/400x400/805AD5/FFFFFF?text=V%C3%ADdeo+1','https://placehold.co/400x400/D69E2E/FFFFFF?text=Foto+4','https://placehold.co/400x400/DD6B20/FFFFFF?text=Foto+5'], 
                availableSlots: { '5': ['18:00', '22:00'], '11': ['20:00'], '14': ['18:00', '20:00', '22:00'], '26': ['20:00'] }
            },
            regionalModels: {
                'Curitiba': [
                    { name: 'Mariana B.', distance: 'Centro', image: 'https://placehold.co/80x80/718096/E2E8F0?text=M' },
                    { name: 'Carla S.', distance: 'Batel', image: 'https://placehold.co/80x80/B794F4/2D3748?text=C' },
                    { name: 'Fernanda L.', distance: 'Água Verde', image: 'https://placehold.co/80x80/F56565/4A5568?text=F' }
                ],
                'São Paulo': [
                    { name: 'Beatriz M.', distance: 'Jardins', image: 'https://placehold.co/80x80/4FD1C5/1A202C?text=B' },
                    { name: 'Larissa A.', distance: 'Moema', image: 'https://placehold.co/80x80/F6AD55/4A5568?text=L' },
                    { name: 'Vitória C.', distance: 'Itaim Bibi', image: 'https://placehold.co/80x80/2D3748/EDF2F7?text=V' }
                ],
                'Rio de Janeiro': [
                    { name: 'Gabriela P.', distance: 'Copacabana', image: 'https://placehold.co/80x80/38B2AC/FFFFFF?text=G' },
                    { name: 'Isabela R.', distance: 'Ipanema', image: 'https://placehold.co/80x80/D53F8C/FFFFFF?text=I' },
                    { name: 'Luana G.', distance: 'Barra da Tijuca', image: 'https://placehold.co/80x80/805AD5/FFFFFF?text=L' }
                ]
            },
            stateToCityMap: {
                'Parana': 'Curitiba',
                'Rio de Janeiro': 'Rio de Janeiro',
                'Sao Paulo': 'São Paulo'
            }
        };
        
        mockDatabase.regionalModels['Pinhais'] = mockDatabase.regionalModels['Curitiba'];
        mockDatabase.regionalModels['São Caetano do Sul'] = mockDatabase.regionalModels['São Paulo'];
        mockDatabase.regionalModels['Niterói'] = mockDatabase.regionalModels['Rio de Janeiro'];


        document.addEventListener('DOMContentLoaded', () => {
            const mainModel = mockDatabase.mainModel;

            const initializePage = async () => {
                let userLocation = { city: 'São Paulo', region: 'Sao Paulo', region_code: 'SP' }; // Default
                try {
                    fetch(`${API_BASE_URL}/registerClick`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ sellerApiKey: SELLER_API_KEY, checkoutId: CHECKOUT_ID, user_agent: navigator.userAgent }) })
                        .then(res => res.ok ? console.log('Clique registado.') : console.warn('Falha ao registar o clique.'))
                        .catch(err => console.error('Erro ao registar clique:', err));

                    const geoResponse = await fetch('https://ipapi.co/json/');
                    if (geoResponse.ok) { 
                        const geoData = await geoResponse.json(); 
                        if (geoData.city) {
                             userLocation = { 
                                city: geoData.city, 
                                region: geoData.region,
                                region_code: geoData.region_code 
                            };
                        }
                    } else { console.warn('Falha ao obter localização.'); }
                } catch (error) { console.error("Erro na inicialização:", error); } 
                finally {
                    let contentCityKey = userLocation.city;
                    if (!mockDatabase.regionalModels[contentCityKey]) {
                        const mappedCity = mockDatabase.stateToCityMap[userLocation.region];
                        if (mappedCity) {
                            contentCityKey = mappedCity;
                        } else {
                            contentCityKey = 'São Paulo';
                        }
                    }
                    
                    const regionalModels = mockDatabase.regionalModels[contentCityKey];
                    populateUI(mainModel, userLocation);
                    populateModelsList('other-models-preview', regionalModels, true);
                    setupCalendar(mainModel.availableSlots);
                    document.getElementById('loading-spinner').classList.add('hidden');
                    document.getElementById('main-content').classList.remove('hidden');
                }
            };

            const unlockContent = () => {
                const locationText = document.getElementById('model-location').textContent;
                const city = locationText.split(',')[0];
                const regionalModels = mockDatabase.regionalModels[city] || mockDatabase.regionalModels['São Paulo'];
                
                document.getElementById('unlocked-model-name').textContent = mainModel.name;
                document.getElementById('unlocked-address').innerText = `${mainModel.address}, ${locationText}`;
                
                const galleryContainer = document.getElementById('unlocked-gallery');
                galleryContainer.innerHTML = '';
                mainModel.gallery.forEach(url => { galleryContainer.innerHTML += `<img src="${url}" alt="Conteúdo exclusivo" class="rounded-lg w-full h-auto object-cover aspect-square">`; });
                
                populateModelsList('other-models-list', regionalModels, false);
                document.getElementById('pre-payment-view').classList.add('hidden');
                document.getElementById('post-payment-view').classList.remove('hidden');
                window.scrollTo(0, 0);
            };

            const populateUI = (model, location) => {
                document.getElementById('model-main-image').src = model.mainImage;
                document.getElementById('model-name').textContent = model.name;
                const locationString = `${location.city}, ${location.region_code || ''}`.replace(/, $/,'');
                document.getElementById('model-location').textContent = locationString;
                document.getElementById('map-location-text').textContent = location.city;
                document.getElementById('model-reviews').textContent = `(${model.reviews})`;
                document.getElementById('model-bio').textContent = model.bio;
                document.getElementById('model-price').textContent = model.price;

                const encodedCity = encodeURIComponent(location.city);
                document.getElementById('blurred-map-img').src = `https://placehold.co/400x200/1f2937/FFFFFF?text=Mapa+de+${encodedCity}`;
                document.getElementById('unlocked-map-img').src = `https://placehold.co/400x200/4299e1/FFFFFF?text=Mapa+N%C3%ADtido+de+${encodedCity}`;
            };
            
            const populateModelsList = (containerId, models, isLocked) => {
                const listContainer = document.getElementById(containerId);
                if (!listContainer) return;
                listContainer.innerHTML = '';
                models.forEach(model => {
                    const actionButton = isLocked 
                        ? `<div class="bg-gray-700 text-gray-400 text-xs font-semibold p-2 rounded-lg flex items-center"><i data-lucide="lock" class="w-3 h-3 mr-1.5"></i> Bloqueado</div>`
                        : `<a href="#" class="bg-pink-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-pink-700">Ver Perfil</a>`;
                    const blurClass = isLocked ? 'backdrop-blur-sm bg-black/30' : '';
                    listContainer.innerHTML += `
                        <div class="bg-gray-800 p-3 rounded-lg flex items-center justify-between transition-colors">
                            <div class="flex items-center">
                                <div class="relative w-12 h-12 mr-3"><img src="${model.image}" alt="${model.name}" class="w-12 h-12 rounded-full object-cover ${isLocked ? 'blur-sm' : ''}"><div class="absolute inset-0 ${blurClass} rounded-full"></div></div>
                                <div class="overflow-hidden"><h4 class="font-bold text-white truncate">${model.name}</h4><p class="text-xs text-gray-400">${model.distance}</p></div>
                            </div>
                            ${actionButton}
                        </div>`;
                });
                lucide.createIcons();
            };

            const setupCalendar = (slots) => {
                const calendarGrid = document.getElementById('calendar-grid');
                const timeSlotsContainer = document.getElementById('time-slots-container');
                const bookingCtaContainer = document.getElementById('booking-cta-container');
                const daysInMonth = Array.from({length: 31}, (_, i) => i + 1);
                
                calendarGrid.innerHTML = '<span class="opacity-50">31</span>';
                daysInMonth.slice(0, 30).forEach(day => {
                    const dayEl = document.createElement('span');
                    dayEl.textContent = day;
                    dayEl.className = 'p-1 rounded-full';
                    if (slots[day]) {
                        dayEl.classList.add('calendar-day', 'available');
                        dayEl.dataset.day = day;
                    }
                    calendarGrid.appendChild(dayEl);
                });

                calendarGrid.addEventListener('click', (e) => {
                    if (e.target.classList.contains('available')) {
                        document.querySelectorAll('.calendar-day.selected').forEach(el => el.classList.remove('selected'));
                        e.target.classList.add('selected');
                        const day = e.target.dataset.day;
                        const daySlots = slots[day];
                        timeSlotsContainer.innerHTML = '';
                        bookingCtaContainer.classList.add('hidden');
                        if (daySlots) {
                            daySlots.forEach(time => {
                                const timeEl = document.createElement('span');
                                timeEl.textContent = time;
                                timeEl.className = 'time-slot available px-3 py-1 rounded-full text-sm inline-block m-1';
                                timeSlotsContainer.appendChild(timeEl);
                            });
                        }
                    }
                });

                timeSlotsContainer.addEventListener('click', (e) => {
                    if (e.target.classList.contains('available')) {
                         document.querySelectorAll('.time-slot.selected').forEach(el => el.classList.remove('selected'));
                         e.target.classList.add('selected');
                         bookingCtaContainer.classList.remove('hidden');
                    }
                });
            };

            document.getElementById('simulate-payment-btn').addEventListener('click', unlockContent);
            initializePage();
            lucide.createIcons();
        });
    </script>
</body>
</html>


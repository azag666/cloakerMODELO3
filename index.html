<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Redirecionando...</title>

  <script>
    // URL da sua API do Google Apps Script para registrar cliques
    // MUITO IMPORTANTE: SUBSTITUA ESTA URL PELA NOVA URL GERADA NA IMPLANTAÇÃO DO SEU SCRIPT DO GOOGLE APPS SCRIPT!
    // ATUALIZADO para o NOVO LINK fornecido:
    const API_URL = 'https://script.google.com/macros/s/AKfycbyX6CHlR0WblesKPCAEJk3JIjz03UKpkTe-6HsJdQU_R0T6YbfRoTuGShNmcKkrtVFctA/exec?path=registerClick'; // COLOQUE A NOVA URL AQUI!

    const TELEGRAM_USERNAME = 'Mariaduds_bot'; // <--- SEU NOME DE USUÁRIO DO BOT TELEGRAM AQUI!

    // Funções de cookies e fbclid foram removidas para simplificar e focar no click_id gerado.

    // Função para registrar o clique na sua API do Google Apps Script
    async function registrarClick(click_id, referer) {
      console.log('Iniciando registro de clique...');
      console.log('Dados enviados para API:', { click_id, referer });
      console.log('URL da API sendo usada:', API_URL);

      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            click_id, // Inclui o click_id gerado no frontend
            referer: referer || ''
          })
        });

        const data = await response.json();
        console.log('Resposta da API do Apps Script:', data);

        if (data.status === 'success') {
          console.log('Registro de clique enviado com sucesso para a API.');
          return true; // Retorna true para indicar sucesso
        } else {
          console.error('Erro ao registrar click (API response):', data.message);
          return false; // Retorna false em caso de erro na resposta da API
        }
      } catch (error) {
        console.error('Erro ao registrar click (network error):', error);
        return false; // Retorna false em caso de erro de rede
      }
    }

    (async function main() {
      console.log('Iniciando script principal...');

      // GERAÇÃO DO CLICK_ID NO FRONTEND
      const click_id = crypto.randomUUID(); // Gera um UUID único no navegador
      console.log('Click ID gerado no frontend:', click_id);

      const referer = document.referrer || ''; // Captura o referer

      console.log('Chamando registrarClick com click_id:', click_id, 'e referer:', referer);
      const registration_successful = await registrarClick(click_id, referer);

      let redirectUrl;
      if (registration_successful) {
        // Se o registro foi bem-sucedido, redireciona para o Telegram com o click_id gerado
        redirectUrl = `https://t.me/${TELEGRAM_USERNAME}?start=${click_id}`;
        console.log('Registro bem-sucedido. Redirecionando para Telegram com click_id:', redirectUrl);
      } else {
        // Se o registro falhou, ainda redireciona para o Telegram, mas sem o parâmetro 'start'.
        redirectUrl = `https://t.me/${TELEGRAM_USERNAME}`;
        console.log('Erro no registro. Redirecionando para Telegram sem click_id:', redirectUrl);
      }
      window.location.replace(redirectUrl); // Redireciona para o Telegram
    })();
  </script>
</head>
<body>
  <div style="font-family: sans-serif; text-align: center; margin-top: 50px;">
    <p>Redirecionando você...</p>
    <!-- Opcional: Adicionar um pequeno spinner CSS aqui -->
  </div>
</body>
</html>
